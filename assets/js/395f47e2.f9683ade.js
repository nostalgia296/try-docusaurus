"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[912],{8081:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"advanced","title":"\u9ad8\u7ea7\u4e3b\u9898","description":"\u672c\u6587\u6863\u4ecb\u7ecd GitHub Release Manager \u7684\u9ad8\u7ea7\u7528\u6cd5\u548c\u6700\u4f73\u5b9e\u8df5\u3002","source":"@site/docs/advanced.md","sourceDirName":".","slug":"/advanced","permalink":"/try-docusaurus/docs/advanced","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"\u547d\u4ee4\u53c2\u8003","permalink":"/try-docusaurus/docs/commands"}}');var i=l(4848),a=l(8453);const r={sidebar_position:6},c="\u9ad8\u7ea7\u4e3b\u9898",d={},t=[{value:"\u9ad8\u7ea7\u529f\u80fd",id:"\u9ad8\u7ea7\u529f\u80fd",level:2},{value:"\u901a\u914d\u7b26\u5339\u914d",id:"\u901a\u914d\u7b26\u5339\u914d",level:3},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:4},{value:"\u6279\u91cf\u64cd\u4f5c\u4f18\u5316",id:"\u6279\u91cf\u64cd\u4f5c\u4f18\u5316",level:3},{value:"1. \u5927\u6279\u91cf\u6587\u4ef6\u5904\u7406",id:"1-\u5927\u6279\u91cf\u6587\u4ef6\u5904\u7406",level:4},{value:"2. \u5e76\u884c\u5904\u7406",id:"2-\u5e76\u884c\u5904\u7406",level:4},{value:"3. \u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5",id:"3-\u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5",level:4},{value:"\u5b89\u5168\u6027\u6700\u4f73\u5b9e\u8df5",id:"\u5b89\u5168\u6027\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. Token \u5b89\u5168\u7ba1\u7406",id:"1-token-\u5b89\u5168\u7ba1\u7406",level:3},{value:"\u65b9\u6848 A\uff1a\u4f7f\u7528 Token \u6587\u4ef6\uff08\u63a8\u8350\uff09",id:"\u65b9\u6848-a\u4f7f\u7528-token-\u6587\u4ef6\u63a8\u8350",level:4},{value:"\u65b9\u6848 B\uff1a\u4f7f\u7528\u5bc6\u94a5\u7ba1\u7406\u670d\u52a1",id:"\u65b9\u6848-b\u4f7f\u7528\u5bc6\u94a5\u7ba1\u7406\u670d\u52a1",level:4},{value:"\u65b9\u6848 C\uff1a\u4f7f\u7528 GNU Pass",id:"\u65b9\u6848-c\u4f7f\u7528-gnu-pass",level:4},{value:"2. \u914d\u7f6e\u6587\u4ef6\u6743\u9650",id:"2-\u914d\u7f6e\u6587\u4ef6\u6743\u9650",level:3},{value:"3. \u907f\u514d\u5728\u547d\u4ee4\u884c\u4e2d\u66b4\u9732 Token",id:"3-\u907f\u514d\u5728\u547d\u4ee4\u884c\u4e2d\u66b4\u9732-token",level:3},{value:"4. \u5ba1\u8ba1\u548c\u65e5\u5fd7",id:"4-\u5ba1\u8ba1\u548c\u65e5\u5fd7",level:3},{value:"CI/CD \u96c6\u6210\u9ad8\u7ea7\u7528\u6cd5",id:"cicd-\u96c6\u6210\u9ad8\u7ea7\u7528\u6cd5",level:2},{value:"GitHub Actions \u5b8c\u6574\u793a\u4f8b",id:"github-actions-\u5b8c\u6574\u793a\u4f8b",level:3},{value:"GitLab CI \u5b8c\u6574\u793a\u4f8b",id:"gitlab-ci-\u5b8c\u6574\u793a\u4f8b",level:3},{value:"Jenkins Pipeline \u793a\u4f8b",id:"jenkins-pipeline-\u793a\u4f8b",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"1. \u542f\u7528 HTTP/2",id:"1-\u542f\u7528-http2",level:3},{value:"2. \u8c03\u6574\u7f13\u51b2\u533a\u5927\u5c0f",id:"2-\u8c03\u6574\u7f13\u51b2\u533a\u5927\u5c0f",level:3},{value:"3. \u7f51\u7edc\u4f18\u5316",id:"3-\u7f51\u7edc\u4f18\u5316",level:3},{value:"4. \u538b\u7f29\u6587\u4ef6",id:"4-\u538b\u7f29\u6587\u4ef6",level:3},{value:"\u6545\u969c\u6392\u9664",id:"\u6545\u969c\u6392\u9664",level:2},{value:"\u95ee\u9898 1\uff1a\u4e0a\u4f20\u901f\u5ea6\u6162",id:"\u95ee\u9898-1\u4e0a\u4f20\u901f\u5ea6\u6162",level:3},{value:"\u95ee\u9898 2\uff1a\u9891\u7e41\u89e6\u53d1 API \u9650\u5236",id:"\u95ee\u9898-2\u9891\u7e41\u89e6\u53d1-api-\u9650\u5236",level:3},{value:"\u95ee\u9898 3\uff1a\u5927\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25",id:"\u95ee\u9898-3\u5927\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25",level:3},{value:"\u95ee\u9898 4\uff1aToken \u6743\u9650\u4e0d\u8db3",id:"\u95ee\u9898-4token-\u6743\u9650\u4e0d\u8db3",level:3},{value:"\u95ee\u9898 5\uff1aRelease \u4e0d\u5b58\u5728",id:"\u95ee\u9898-5release-\u4e0d\u5b58\u5728",level:3},{value:"\u76d1\u63a7\u548c\u65e5\u5fd7",id:"\u76d1\u63a7\u548c\u65e5\u5fd7",level:2},{value:"\u8be6\u7ec6\u65e5\u5fd7",id:"\u8be6\u7ec6\u65e5\u5fd7",level:3},{value:"JSON \u65e5\u5fd7\u683c\u5f0f",id:"json-\u65e5\u5fd7\u683c\u5f0f",level:3},{value:"\u76d1\u63a7\u811a\u672c",id:"\u76d1\u63a7\u811a\u672c",level:3},{value:"\u81ea\u5b9a\u4e49\u548c\u6269\u5c55",id:"\u81ea\u5b9a\u4e49\u548c\u6269\u5c55",level:2},{value:"\u6dfb\u52a0\u65b0\u529f\u80fd",id:"\u6dfb\u52a0\u65b0\u529f\u80fd",level:3},{value:"\u7f16\u8bd1\u9009\u9879",id:"\u7f16\u8bd1\u9009\u9879",level:3}];function o(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"\u9ad8\u7ea7\u4e3b\u9898",children:"\u9ad8\u7ea7\u4e3b\u9898"})}),"\n",(0,i.jsx)(e.p,{children:"\u672c\u6587\u6863\u4ecb\u7ecd GitHub Release Manager \u7684\u9ad8\u7ea7\u7528\u6cd5\u548c\u6700\u4f73\u5b9e\u8df5\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"\u9ad8\u7ea7\u529f\u80fd",children:"\u9ad8\u7ea7\u529f\u80fd"}),"\n",(0,i.jsx)(e.h3,{id:"\u901a\u914d\u7b26\u5339\u914d",children:"\u901a\u914d\u7b26\u5339\u914d"}),"\n",(0,i.jsx)(e.p,{children:"\u5de5\u5177\u652f\u6301\u6807\u51c6\u7684 Unix \u901a\u914d\u7b26\u6a21\u5f0f\uff1a"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"*"})," - \u5339\u914d\u4efb\u610f\u6570\u91cf\u7684\u5b57\u7b26"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"?"})," - \u5339\u914d\u5355\u4e2a\u5b57\u7b26"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"[abc]"})," - \u5339\u914d\u65b9\u62ec\u53f7\u5185\u7684\u4efb\u610f\u5b57\u7b26"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"[a-z]"})," - \u5339\u914d\u6307\u5b9a\u8303\u56f4\u5185\u7684\u4efb\u610f\u5b57\u7b26"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5339\u914d\u6240\u6709 .zip \u6587\u4ef6\n./manage upload *.zip\n\n# \u5339\u914d\u4ee5 backup- \u5f00\u5934\uff0c\u65e5\u671f\u4e3a 2024-01-xx \u7684\u6587\u4ef6\n./manage upload backup-2024-01-*.zip\n\n# \u5339\u914d\u5355\u4e2a\u5b57\u7b26\u53d8\u5316\n./manage upload file?.txt  # \u5339\u914d file1.txt, file2.txt \u7b49\n\n# \u5339\u914d\u65b9\u62ec\u53f7\u5185\u7684\u4efb\u610f\u5b57\u7b26\n./manage upload file[123].txt  # \u5339\u914d file1.txt, file2.txt, file3.txt\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u6279\u91cf\u64cd\u4f5c\u4f18\u5316",children:"\u6279\u91cf\u64cd\u4f5c\u4f18\u5316"}),"\n",(0,i.jsx)(e.h4,{id:"1-\u5927\u6279\u91cf\u6587\u4ef6\u5904\u7406",children:"1. \u5927\u6279\u91cf\u6587\u4ef6\u5904\u7406"}),"\n",(0,i.jsx)(e.p,{children:"\u5904\u7406\u5927\u91cf\u6587\u4ef6\u65f6\uff08> 100 \u4e2a\uff09\uff0c\u5efa\u8bae\u5206\u6279\u5904\u7406\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# batch_upload.sh\n\n# \u6bcf\u6279 50 \u4e2a\u6587\u4ef6\u5206\u6279\u4e0a\u4f20\nFILES=(*.zip)\nBATCH_SIZE=50\n\nfor ((i=0; i<${#FILES[@]}; i+=BATCH_SIZE)); do\n    BATCH=(${FILES[@]:i:BATCH_SIZE})\n    ./manage upload "${BATCH[@]}"\ndone\n'})}),"\n",(0,i.jsx)(e.h4,{id:"2-\u5e76\u884c\u5904\u7406",children:"2. \u5e76\u884c\u5904\u7406"}),"\n",(0,i.jsx)(e.p,{children:"\u4f7f\u7528 GNU parallel \u8fdb\u884c\u5e76\u884c\u4e0a\u4f20\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5 parallel\uff08Ubuntu/Debian\uff09\nsudo apt-get install parallel\n\n# \u5e76\u884c\u4e0a\u4f20\uff08\u6700\u591a 4 \u4e2a\u5e76\u53d1\uff09\nls *.zip | parallel -j 4 ./manage upload {}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"3-\u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5",children:"3. \u9519\u8bef\u5904\u7406\u548c\u91cd\u8bd5"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u811a\u672c\u4e2d\u5904\u7406\u9519\u8bef\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n\n# \u4e0a\u4f20\u6587\u4ef6\uff0c\u5931\u8d25\u65f6\u91cd\u8bd5 3 \u6b21\nupload_with_retry() {\n    local file=$1\n    local retries=3\n    local count=0\n\n    until ./manage upload "$file"; do\n        ((count++))\n        if [ $count -ge $retries ]; then\n            echo "\u4e0a\u4f20 $file \u5931\u8d25!")\n            return 1\n        fi\n        echo "\u91cd\u8bd5 $count/$retries..."\n        sleep 5\ndone\n}\n\n# \u4e0a\u4f20\u6240\u6709 zip \u6587\u4ef6\nfor file in *.zip; do\n    upload_with_retry "$file"\ndone\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u5b89\u5168\u6027\u6700\u4f73\u5b9e\u8df5",children:"\u5b89\u5168\u6027\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsx)(e.h3,{id:"1-token-\u5b89\u5168\u7ba1\u7406",children:"1. Token \u5b89\u5168\u7ba1\u7406"}),"\n",(0,i.jsx)(e.h4,{id:"\u65b9\u6848-a\u4f7f\u7528-token-\u6587\u4ef6\u63a8\u8350",children:"\u65b9\u6848 A\uff1a\u4f7f\u7528 Token \u6587\u4ef6\uff08\u63a8\u8350\uff09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# 1. \u521b\u5efa token \u6587\u4ef6\necho "ghp_your_token_here" > ~/.github_token\nchmod 600 ~/.github_token\n\n# 2. \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\nexport GITHUB_TOKEN_FILE="$HOME/.github_token"\n\n# 3. \u9a8c\u8bc1\u6743\u9650\nls -la ~/.github_token\n# \u5e94\u8be5\u663e\u793a\uff1a-rw-------\n'})}),"\n",(0,i.jsx)(e.h4,{id:"\u65b9\u6848-b\u4f7f\u7528\u5bc6\u94a5\u7ba1\u7406\u670d\u52a1",children:"\u65b9\u6848 B\uff1a\u4f7f\u7528\u5bc6\u94a5\u7ba1\u7406\u670d\u52a1"}),"\n",(0,i.jsx)(e.p,{children:"\u5728 CI/CD \u73af\u5883\u4e2d\u4f7f\u7528\u5bc6\u94a5\u7ba1\u7406\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# GitHub Actions\nexport GITHUB_TOKEN="${{ secrets.GITHUB_TOKEN }}"\n\n# GitLab CI\nexport GITHUB_TOKEN="$GITHUB_TOKEN"\n\n# AWS Secrets Manager\nexport GITHUB_TOKEN=$(aws secretsmanager get-secret-value \\\n  --secret-id github-token \\\n  --query SecretString \\\n  --output text)\n'})}),"\n",(0,i.jsx)(e.h4,{id:"\u65b9\u6848-c\u4f7f\u7528-gnu-pass",children:"\u65b9\u6848 C\uff1a\u4f7f\u7528 GNU Pass"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5b89\u88c5 pass\nsudo apt-get install pass\n\n# \u5b58\u50a8 token\npass insert github-token\n# \u8f93\u5165: ghp_your_token_here\n\n# \u4f7f\u7528 token\nexport GITHUB_TOKEN=$(pass github-token)\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2-\u914d\u7f6e\u6587\u4ef6\u6743\u9650",children:"2. \u914d\u7f6e\u6587\u4ef6\u6743\u9650"}),"\n",(0,i.jsx)(e.p,{children:"\u59cb\u7ec8\u8bbe\u7f6e\u914d\u7f6e\u6587\u4ef6\u7684\u6743\u9650\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u521b\u5efa\u914d\u7f6e\u6587\u4ef6\n./manage config init\n\n# \u68c0\u67e5\u5f53\u524d\u6743\u9650\nls -la .manage_config.json\n\n# \u8bbe\u7f6e\u5b89\u5168\u6743\u9650\uff08\u4ec5\u6240\u6709\u8005\u53ef\u8bfb\u5199\uff09\nchmod 600 .manage_config.json\n\n# \u9a8c\u8bc1\u6743\u9650\nls -la .manage_config.json\n# \u5e94\u8be5\u663e\u793a\uff1a-rw-------\n"})}),"\n",(0,i.jsx)(e.h3,{id:"3-\u907f\u514d\u5728\u547d\u4ee4\u884c\u4e2d\u66b4\u9732-token",children:"3. \u907f\u514d\u5728\u547d\u4ee4\u884c\u4e2d\u66b4\u9732 Token"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4e0d\u63a8\u8350"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u4e0d\u8981\u5728\u547d\u4ee4\u884c\u4e2d\u76f4\u63a5\u5199 token\n./manage config set token ghp_my_token_here  # \u4f1a\u5728 shell \u5386\u53f2\u4e2d\u4fdd\u5b58\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u63a8\u8350"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# \u65b9\u6cd5 1\uff1a\u4ece\u6587\u4ef6\u8bfb\u53d6\necho ghp_my_token_here > token_file\n./manage config set token $(cat token_file)\nrm token_file\n\n# \u65b9\u6cd5 2\uff1a\u73af\u5883\u53d8\u91cf\nexport GITHUB_TOKEN="ghp_my_token_here"\n'})}),"\n",(0,i.jsx)(e.h3,{id:"4-\u5ba1\u8ba1\u548c\u65e5\u5fd7",children:"4. \u5ba1\u8ba1\u548c\u65e5\u5fd7"}),"\n",(0,i.jsx)(e.p,{children:"\u8bbe\u7f6e\u9002\u5f53\u7684\u65e5\u5fd7\u7ea7\u522b\u8fdb\u884c\u5ba1\u8ba1\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u8bb0\u5f55\u6240\u6709\u64cd\u4f5c\nexport MANAGE_LOG_LEVEL=0  # DEBUG \u7ea7\u522b\n./manage upload *.zip 2> operation.log\n\n# \u67e5\u770b\u65e5\u5fd7\ncat operation.log\n"})}),"\n",(0,i.jsx)(e.h2,{id:"cicd-\u96c6\u6210\u9ad8\u7ea7\u7528\u6cd5",children:"CI/CD \u96c6\u6210\u9ad8\u7ea7\u7528\u6cd5"}),"\n",(0,i.jsx)(e.h3,{id:"github-actions-\u5b8c\u6574\u793a\u4f8b",children:"GitHub Actions \u5b8c\u6574\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"name: Release Management\n\non:\n  push:\n    tags:\n      - 'v*'\n  workflow_dispatch:\n    inputs:\n      version:\n        description: '\u7248\u672c\u53f7'\n        required: true\n        type: string\n\nenv:\n  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n  GITHUB_OWNER: ${{ github.repository_owner }}\n  GITHUB_REPO: ${{ github.event.repository.name }}\n\njobs:\n  build-and-upload:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install dependencies\n        run: |\n          sudo apt-get update\n          sudo apt-get install -y libcurl4-openssl-dev libjson-c-dev\n\n      - name: Compile GitHub Release Manager\n        run: |\n          gcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c)\n\n      - name: Build application\n        run: |\n          make build VERSION=${{ github.event.inputs.version || github.ref_name }}\n\n      - name: Create Release\n        if: github.event_name == 'push'\n        run: |\n          ./manage create-release ${{ github.ref_name }} \\\n            --name \"Release ${{ github.ref_name }}\" \\\n            --description \"Auto-generated release\" \\\n            build/*\n\n      - name: Upload files\n        if: github.event_name == 'workflow_dispatch'\n        run: |\n          ./manage upload build/*\n\n      - name: List Release files\n        run: |\n          ./manage list\n"})}),"\n",(0,i.jsx)(e.h3,{id:"gitlab-ci-\u5b8c\u6574\u793a\u4f8b",children:"GitLab CI \u5b8c\u6574\u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'stages:\n  - build\n  - release\n\nvariables:\n  GITHUB_TOKEN: $GITHUB_TOKEN\n  GITHUB_OWNER: "your-username"\n  GITHUB_REPO: "your-repo"\n\nbefore_script:\n  - apt-get update -qq\n  - apt-get install -y build-essential libcurl4-openssl-dev libjson-c-dev\n  - gcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c)\n\nbuild:\n  stage: build\n  script:\n    - make build VERSION=$CI_COMMIT_TAG\n  artifacts:\n    paths:\n      - build/\n    expire_in: 1 week\n\ncreate:release:\n  stage: release\n  only:\n    - tags\n  script:\n    - ./manage create-release $CI_COMMIT_TAG \\\n        --name "Release $CI_COMMIT_TAG" \\\n        --description "Release from GitLab CI" \\\n        build/*\n\nupload:artifacts:\n  stage: release\n  only:\n    - main\n  script:\n    - ./manage upload build/*\n'})}),"\n",(0,i.jsx)(e.h3,{id:"jenkins-pipeline-\u793a\u4f8b",children:"Jenkins Pipeline \u793a\u4f8b"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-groovy",children:"pipeline {\n    agent any\n\n    environment {\n        GITHUB_TOKEN = credentials('github-token')\n        GITHUB_OWNER = 'your-username'\n        GITHUB_REPO = 'your-repo'\n    }\n\n    stages {\n        stage('Build') {\n            steps {\n                sh 'make build'\n            }\n        }\n\n        stage('Compile Release Manager') {\n            steps {\n                sh '''\n                    gcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c)\n                '''\n            }\n        }\n\n        stage('Create Release') {\n            when {\n                buildingTag()\n            }\n            steps {\n                sh '''\n                    ./manage create-release ${TAG_NAME} \\\n                        --name \"Release ${TAG_NAME}\" \\\n                        build/*\n                '''\n            }\n        }\n\n        stage('Upload Artifacts') {\n            steps {\n                sh './manage upload build/*'\n            }\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,i.jsx)(e.h3,{id:"1-\u542f\u7528-http2",children:"1. \u542f\u7528 HTTP/2"}),"\n",(0,i.jsx)(e.p,{children:"\u7f16\u8bd1\u65f6\u542f\u7528 HTTP/2\uff08\u5982\u679c libcurl \u652f\u6301\uff09\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"gcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c) \\\n  -DCURL_HTTP_VERSION_2TLS\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2-\u8c03\u6574\u7f13\u51b2\u533a\u5927\u5c0f",children:"2. \u8c03\u6574\u7f13\u51b2\u533a\u5927\u5c0f"}),"\n",(0,i.jsx)(e.p,{children:"\u4fee\u6539\u6e90\u4ee3\u7801\u4e2d\u7684\u7f13\u51b2\u533a\u5927\u5c0f\uff08\u5982\u679c\u9700\u8981\u4e0a\u4f20\u8d85\u5927\u6587\u4ef6\uff09\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"// \u5728 manage.c \u4e2d\u627e\u5230\u4ee5\u4e0b\u884c\u5e76\u8c03\u6574\n#define UPLOAD_BUFFER_SIZE 8192  // \u589e\u5927\u7f13\u51b2\u533a\n"})}),"\n",(0,i.jsx)(e.h3,{id:"3-\u7f51\u7edc\u4f18\u5316",children:"3. \u7f51\u7edc\u4f18\u5316"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u9ad8\u5ef6\u8fdf\u7f51\u7edc\u73af\u5883\u4e2d\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u51cf\u5c11\u91cd\u8bd5\u5ef6\u8fdf\uff08\u4fee\u6539\u6e90\u4ee3\u7801\u4e2d\u7684 baseDelay\uff09\nstatic int baseDelay = 1;  // \u4ece 1 \u79d2\u5f00\u59cb\n\n# \u589e\u52a0\u8d85\u65f6\u65f6\u95f4\n# \u5728 curl \u8bbe\u7f6e\u4e2d\u6dfb\u52a0\ncurl_easy_setopt(curl, CURLOPT_TIMEOUT, 300L);  // 5 \u5206\u949f\u8d85\u65f6\n"})}),"\n",(0,i.jsx)(e.h3,{id:"4-\u538b\u7f29\u6587\u4ef6",children:"4. \u538b\u7f29\u6587\u4ef6"}),"\n",(0,i.jsx)(e.p,{children:"\u4e0a\u4f20\u524d\u538b\u7f29\u5927\u6587\u4ef6\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"#!/bin/bash\n# compress-and-upload.sh\n\n# \u538b\u7f29\u6587\u4ef6\uff08\u4f7f\u7528\u5e76\u884c\u538b\u7f29\uff09\ntar -I 'pigz -p 4' -cf archive.tar.gz data/\n\n# \u4e0a\u4f20\u538b\u7f29\u6587\u4ef6\n./manage upload archive.tar.gz\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6545\u969c\u6392\u9664",children:"\u6545\u969c\u6392\u9664"}),"\n",(0,i.jsx)(e.h3,{id:"\u95ee\u9898-1\u4e0a\u4f20\u901f\u5ea6\u6162",children:"\u95ee\u9898 1\uff1a\u4e0a\u4f20\u901f\u5ea6\u6162"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u539f\u56e0"}),"\uff1a\u7f51\u7edc\u5ef6\u8fdf\u6216\u5e26\u5bbd\u9650\u5236"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u538b\u7f29\u6587\u4ef6"}),"\n",(0,i.jsx)(e.li,{children:"\u4f7f\u7528\u591a\u7ebf\u7a0b\u4e0a\u4f20\u5de5\u5177"}),"\n",(0,i.jsx)(e.li,{children:"\u9009\u62e9\u5c31\u8fd1\u7684 GitHub \u6570\u636e\u4e2d\u5fc3"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u95ee\u9898-2\u9891\u7e41\u89e6\u53d1-api-\u9650\u5236",children:"\u95ee\u9898 2\uff1a\u9891\u7e41\u89e6\u53d1 API \u9650\u5236"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u539f\u56e0"}),"\uff1a\u6279\u91cf\u64cd\u4f5c\u8fc7\u4e8e\u9891\u7e41"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u589e\u52a0\u5ef6\u8fdf\uff08\u5de5\u5177\u5df2\u81ea\u52a8\u6dfb\u52a0 0.1 \u79d2\u5ef6\u8fdf\uff09"}),"\n",(0,i.jsx)(e.li,{children:"\u51cf\u5c11\u5e76\u53d1\u6570"}),"\n",(0,i.jsx)(e.li,{children:"\u8054\u7cfb GitHub \u63d0\u9ad8 API \u9650\u5236"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u95ee\u9898-3\u5927\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25",children:"\u95ee\u9898 3\uff1a\u5927\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u539f\u56e0"}),"\uff1a\u7f51\u7edc\u8d85\u65f6\u6216\u6587\u4ef6\u5927\u5c0f\u9650\u5236"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5206\u5272\u5927\u6587\u4ef6\uff1a",(0,i.jsx)(e.code,{children:"split -b 100M largefile.bin part-"})]}),"\n",(0,i.jsx)(e.li,{children:"\u589e\u52a0\u8d85\u65f6\u65f6\u95f4"}),"\n",(0,i.jsx)(e.li,{children:"\u786e\u4fdd\u6587\u4ef6 < 2GB\uff08GitHub \u9650\u5236\uff09"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u95ee\u9898-4token-\u6743\u9650\u4e0d\u8db3",children:"\u95ee\u9898 4\uff1aToken \u6743\u9650\u4e0d\u8db3"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u9519\u8bef"}),"\uff1a",(0,i.jsx)(e.code,{children:"404 Not Found"})," \u6216 ",(0,i.jsx)(e.code,{children:"403 Forbidden"})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u68c0\u67e5 token \u662f\u5426\u6709 ",(0,i.jsx)(e.code,{children:"repo"})," \u4f5c\u7528\u57df"]}),"\n",(0,i.jsx)(e.li,{children:"\u68c0\u67e5\u4ed3\u5e93\u662f\u5426\u5b58\u5728"}),"\n",(0,i.jsx)(e.li,{children:"\u68c0\u67e5\u662f\u5426\u6709\u5199\u5165\u6743\u9650"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u95ee\u9898-5release-\u4e0d\u5b58\u5728",children:"\u95ee\u9898 5\uff1aRelease \u4e0d\u5b58\u5728"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u9519\u8bef"}),"\uff1a",(0,i.jsx)(e.code,{children:'\u672a\u627e\u5230tag\u4e3a "v1.0.0" \u7684release'})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5148\u521b\u5efa Release\n./manage create-release v1.0.0\n\n# \u7136\u540e\u4e0a\u4f20\u6587\u4ef6\n./manage upload *.zip\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u76d1\u63a7\u548c\u65e5\u5fd7",children:"\u76d1\u63a7\u548c\u65e5\u5fd7"}),"\n",(0,i.jsx)(e.h3,{id:"\u8be6\u7ec6\u65e5\u5fd7",children:"\u8be6\u7ec6\u65e5\u5fd7"}),"\n",(0,i.jsx)(e.p,{children:"\u542f\u7528\u8c03\u8bd5\u65e5\u5fd7\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u8bbe\u7f6e\u65e5\u5fd7\u7ea7\u522b\u4e3a DEBUG\nexport MANAGE_LOG_LEVEL=0\n\n# \u91cd\u5b9a\u5411\u65e5\u5fd7\u5230\u6587\u4ef6\n./manage upload *.zip 2> debug.log\n\n# \u67e5\u770b\u5b9e\u65f6\u65e5\u5fd7\ntail -f debug.log\n"})}),"\n",(0,i.jsx)(e.h3,{id:"json-\u65e5\u5fd7\u683c\u5f0f",children:"JSON \u65e5\u5fd7\u683c\u5f0f"}),"\n",(0,i.jsx)(e.p,{children:"\u5bf9\u4e8e\u65e5\u5fd7\u6536\u96c6\u7cfb\u7edf\uff0c\u53ef\u4ee5\u4fee\u6539\u6e90\u4ee3\u7801\u8f93\u51fa JSON \u683c\u5f0f\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:'// \u4fee\u6539 log_message \u51fd\u6570\u8f93\u51fa JSON\nfprintf(stderr, "{\\"level\\":\\"%s\\",\\"message\\":\\"", level_strs[level]);\nvfprintf(stderr, fmt, args);\nfprintf(stderr, "\\"}\\n");\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u76d1\u63a7\u811a\u672c",children:"\u76d1\u63a7\u811a\u672c"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# monitor.sh\n\nLOG_FILE="/var/log/github-release-manager.log"\n\n# \u76d1\u63a7\u4e0a\u4f20\u64cd\u4f5c\nupload_and_log() {\n    local files=$1\n    local timestamp=$(date \'+%Y-%m-%d %H:%M:%S\')\n\n    echo "[$timestamp] Starting upload: $files" >> $LOG_FILE\n\n    if ./manage upload $files; then\n        echo "[$timestamp] Upload success: $files" >> $LOG_FILE\n        return 0\n    else\n        echo "[$timestamp] Upload failed: $files" >> $LOG_FILE\n        return 1\n    fi\n}\n\n# \u4f7f\u7528\u793a\u4f8b\nupload_and_log "*.zip"\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u81ea\u5b9a\u4e49\u548c\u6269\u5c55",children:"\u81ea\u5b9a\u4e49\u548c\u6269\u5c55"}),"\n",(0,i.jsx)(e.h3,{id:"\u6dfb\u52a0\u65b0\u529f\u80fd",children:"\u6dfb\u52a0\u65b0\u529f\u80fd"}),"\n",(0,i.jsx)(e.p,{children:"\u8981\u6dfb\u52a0\u65b0\u547d\u4ee4\uff0c\u9700\u8981\uff1a"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u5b9e\u73b0\u529f\u80fd\u51fd\u6570\uff1a"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"// \u5728 manage.c \u4e2d\u6dfb\u52a0\nstatic ErrorCode myNewCommand(const char *param, const Config *config) {\n    // \u5b9e\u73b0\u529f\u80fd\n    return ERR_OK;\n}\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:"\u5728\u4e3b\u51fd\u6570\u4e2d\u6dfb\u52a0\u547d\u4ee4\u5904\u7406\uff1a"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:'// \u5728 main \u51fd\u6570\u7684\u547d\u4ee4\u5904\u7406\u90e8\u5206\nelse if (strcmp(command, "my-command") == 0) {\n    // \u8c03\u7528\u4f60\u7684\u51fd\u6570\n}\n'})}),"\n",(0,i.jsxs)(e.ol,{start:"3",children:["\n",(0,i.jsxs)(e.li,{children:["\u66f4\u65b0\u5e2e\u52a9\u4fe1\u606f\uff08",(0,i.jsx)(e.code,{children:"showUsage"})," \u548c ",(0,i.jsx)(e.code,{children:"showDetailedUsage"})," \u51fd\u6570\uff09"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u7f16\u8bd1\u9009\u9879",children:"\u7f16\u8bd1\u9009\u9879"}),"\n",(0,i.jsx)(e.p,{children:"\u7f16\u8bd1\u65f6\u6dfb\u52a0\u81ea\u5b9a\u4e49\u9009\u9879\uff1a"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u542f\u7528\u6240\u6709\u8b66\u544a\n\ngcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c) \\\n  -Wall -Wextra -Wpedantic -O2\n\n# \u9759\u6001\u94fe\u63a5\uff08\u751f\u6210\u72ec\u7acb\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4e0d\u63a8\u8350\uff0c\u4f46\u53ef\u80fd\u5728\u67d0\u4e9b\u73af\u5883\u9700\u8981\uff09\n\ngcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c) \\\n  -static -O2\n"})})]})}function h(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},8453:(n,e,l)=>{l.d(e,{R:()=>r,x:()=>c});var s=l(6540);const i={},a=s.createContext(i);function r(n){const e=s.useContext(a);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),s.createElement(a.Provider,{value:e},n.children)}}}]);