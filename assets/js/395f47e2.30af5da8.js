"use strict";(globalThis.webpackChunkdocs_site=globalThis.webpackChunkdocs_site||[]).push([[912],{8081:(n,e,l)=>{l.r(e),l.d(e,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>t});let s=JSON.parse('{"id":"advanced","title":"\u9AD8\u7EA7\u4E3B\u9898","description":"\u672C\u6587\u6863\u4ECB\u7ECD GitHub Release Manager \u7684\u9AD8\u7EA7\u7528\u6CD5\u548C\u6700\u4F73\u5B9E\u8DF5\u3002","source":"@site/docs/advanced.md","sourceDirName":".","slug":"/advanced","permalink":"/try-docusaurus/docs/advanced","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"\u547D\u4EE4\u53C2\u8003","permalink":"/try-docusaurus/docs/commands"}}');var i=l(4848),a=l(8453);let r={sidebar_position:6},d="\u9AD8\u7EA7\u4E3B\u9898",c={},t=[{value:"\u9AD8\u7EA7\u529F\u80FD",id:"\u9AD8\u7EA7\u529F\u80FD",level:2},{value:"\u901A\u914D\u7B26\u5339\u914D",id:"\u901A\u914D\u7B26\u5339\u914D",level:3},{value:"\u793A\u4F8B",id:"\u793A\u4F8B",level:4},{value:"\u6279\u91CF\u64CD\u4F5C\u4F18\u5316",id:"\u6279\u91CF\u64CD\u4F5C\u4F18\u5316",level:3},{value:"1. \u5927\u6279\u91CF\u6587\u4EF6\u5904\u7406",id:"1-\u5927\u6279\u91CF\u6587\u4EF6\u5904\u7406",level:4},{value:"2. \u5E76\u884C\u5904\u7406",id:"2-\u5E76\u884C\u5904\u7406",level:4},{value:"3. \u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5",id:"3-\u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5",level:4},{value:"\u5B89\u5168\u6027\u6700\u4F73\u5B9E\u8DF5",id:"\u5B89\u5168\u6027\u6700\u4F73\u5B9E\u8DF5",level:2},{value:"1. Token \u5B89\u5168\u7BA1\u7406",id:"1-token-\u5B89\u5168\u7BA1\u7406",level:3},{value:"\u65B9\u6848 A\uFF1A\u4F7F\u7528 Token \u6587\u4EF6\uFF08\u63A8\u8350\uFF09",id:"\u65B9\u6848-a\u4F7F\u7528-token-\u6587\u4EF6\u63A8\u8350",level:4},{value:"\u65B9\u6848 B\uFF1A\u4F7F\u7528\u5BC6\u94A5\u7BA1\u7406\u670D\u52A1",id:"\u65B9\u6848-b\u4F7F\u7528\u5BC6\u94A5\u7BA1\u7406\u670D\u52A1",level:4},{value:"\u65B9\u6848 C\uFF1A\u4F7F\u7528 GNU Pass",id:"\u65B9\u6848-c\u4F7F\u7528-gnu-pass",level:4},{value:"2. \u914D\u7F6E\u6587\u4EF6\u6743\u9650",id:"2-\u914D\u7F6E\u6587\u4EF6\u6743\u9650",level:3},{value:"3. \u907F\u514D\u5728\u547D\u4EE4\u884C\u4E2D\u66B4\u9732 Token",id:"3-\u907F\u514D\u5728\u547D\u4EE4\u884C\u4E2D\u66B4\u9732-token",level:3},{value:"4. \u5BA1\u8BA1\u548C\u65E5\u5FD7",id:"4-\u5BA1\u8BA1\u548C\u65E5\u5FD7",level:3},{value:"CI/CD \u96C6\u6210\u9AD8\u7EA7\u7528\u6CD5",id:"cicd-\u96C6\u6210\u9AD8\u7EA7\u7528\u6CD5",level:2},{value:"GitHub Actions \u5B8C\u6574\u793A\u4F8B",id:"github-actions-\u5B8C\u6574\u793A\u4F8B",level:3},{value:"GitLab CI \u5B8C\u6574\u793A\u4F8B",id:"gitlab-ci-\u5B8C\u6574\u793A\u4F8B",level:3},{value:"Jenkins Pipeline \u793A\u4F8B",id:"jenkins-pipeline-\u793A\u4F8B",level:3},{value:"\u6027\u80FD\u4F18\u5316",id:"\u6027\u80FD\u4F18\u5316",level:2},{value:"1. \u542F\u7528 HTTP/2",id:"1-\u542F\u7528-http2",level:3},{value:"2. \u8C03\u6574\u7F13\u51B2\u533A\u5927\u5C0F",id:"2-\u8C03\u6574\u7F13\u51B2\u533A\u5927\u5C0F",level:3},{value:"3. \u7F51\u7EDC\u4F18\u5316",id:"3-\u7F51\u7EDC\u4F18\u5316",level:3},{value:"4. \u538B\u7F29\u6587\u4EF6",id:"4-\u538B\u7F29\u6587\u4EF6",level:3},{value:"\u6545\u969C\u6392\u9664",id:"\u6545\u969C\u6392\u9664",level:2},{value:"\u95EE\u9898 1\uFF1A\u4E0A\u4F20\u901F\u5EA6\u6162",id:"\u95EE\u9898-1\u4E0A\u4F20\u901F\u5EA6\u6162",level:3},{value:"\u95EE\u9898 2\uFF1A\u9891\u7E41\u89E6\u53D1 API \u9650\u5236",id:"\u95EE\u9898-2\u9891\u7E41\u89E6\u53D1-api-\u9650\u5236",level:3},{value:"\u95EE\u9898 3\uFF1A\u5927\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25",id:"\u95EE\u9898-3\u5927\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25",level:3},{value:"\u95EE\u9898 4\uFF1AToken \u6743\u9650\u4E0D\u8DB3",id:"\u95EE\u9898-4token-\u6743\u9650\u4E0D\u8DB3",level:3},{value:"\u95EE\u9898 5\uFF1ARelease \u4E0D\u5B58\u5728",id:"\u95EE\u9898-5release-\u4E0D\u5B58\u5728",level:3},{value:"\u76D1\u63A7\u548C\u65E5\u5FD7",id:"\u76D1\u63A7\u548C\u65E5\u5FD7",level:2},{value:"\u8BE6\u7EC6\u65E5\u5FD7",id:"\u8BE6\u7EC6\u65E5\u5FD7",level:3},{value:"JSON \u65E5\u5FD7\u683C\u5F0F",id:"json-\u65E5\u5FD7\u683C\u5F0F",level:3},{value:"\u76D1\u63A7\u811A\u672C",id:"\u76D1\u63A7\u811A\u672C",level:3},{value:"\u81EA\u5B9A\u4E49\u548C\u6269\u5C55",id:"\u81EA\u5B9A\u4E49\u548C\u6269\u5C55",level:2},{value:"\u6DFB\u52A0\u65B0\u529F\u80FD",id:"\u6DFB\u52A0\u65B0\u529F\u80FD",level:3},{value:"\u7F16\u8BD1\u9009\u9879",id:"\u7F16\u8BD1\u9009\u9879",level:3}];function o(n){let e={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"\u9AD8\u7EA7\u4E3B\u9898",children:"\u9AD8\u7EA7\u4E3B\u9898"})}),"\n",(0,i.jsx)(e.p,{children:"\u672C\u6587\u6863\u4ECB\u7ECD GitHub Release Manager \u7684\u9AD8\u7EA7\u7528\u6CD5\u548C\u6700\u4F73\u5B9E\u8DF5\u3002"}),"\n",(0,i.jsx)(e.h2,{id:"\u9AD8\u7EA7\u529F\u80FD",children:"\u9AD8\u7EA7\u529F\u80FD"}),"\n",(0,i.jsx)(e.h3,{id:"\u901A\u914D\u7B26\u5339\u914D",children:"\u901A\u914D\u7B26\u5339\u914D"}),"\n",(0,i.jsx)(e.p,{children:"\u5DE5\u5177\u652F\u6301\u6807\u51C6\u7684 Unix \u901A\u914D\u7B26\u6A21\u5F0F\uFF1A"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"*"})," - \u5339\u914D\u4EFB\u610F\u6570\u91CF\u7684\u5B57\u7B26"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"?"})," - \u5339\u914D\u5355\u4E2A\u5B57\u7B26"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"[abc]"})," - \u5339\u914D\u65B9\u62EC\u53F7\u5185\u7684\u4EFB\u610F\u5B57\u7B26"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.code,{children:"[a-z]"})," - \u5339\u914D\u6307\u5B9A\u8303\u56F4\u5185\u7684\u4EFB\u610F\u5B57\u7B26"]}),"\n"]}),"\n",(0,i.jsx)(e.h4,{id:"\u793A\u4F8B",children:"\u793A\u4F8B"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5339\u914D\u6240\u6709 .zip \u6587\u4EF6\n./manage upload *.zip\n\n# \u5339\u914D\u4EE5 backup- \u5F00\u5934\uFF0C\u65E5\u671F\u4E3A 2024-01-xx \u7684\u6587\u4EF6\n./manage upload backup-2024-01-*.zip\n\n# \u5339\u914D\u5355\u4E2A\u5B57\u7B26\u53D8\u5316\n./manage upload file?.txt  # \u5339\u914D file1.txt, file2.txt \u7B49\n\n# \u5339\u914D\u65B9\u62EC\u53F7\u5185\u7684\u4EFB\u610F\u5B57\u7B26\n./manage upload file[123].txt  # \u5339\u914D file1.txt, file2.txt, file3.txt\n"})}),"\n",(0,i.jsx)(e.h3,{id:"\u6279\u91CF\u64CD\u4F5C\u4F18\u5316",children:"\u6279\u91CF\u64CD\u4F5C\u4F18\u5316"}),"\n",(0,i.jsx)(e.h4,{id:"1-\u5927\u6279\u91CF\u6587\u4EF6\u5904\u7406",children:"1. \u5927\u6279\u91CF\u6587\u4EF6\u5904\u7406"}),"\n",(0,i.jsx)(e.p,{children:"\u5904\u7406\u5927\u91CF\u6587\u4EF6\u65F6\uFF08> 100 \u4E2A\uFF09\uFF0C\u5EFA\u8BAE\u5206\u6279\u5904\u7406\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# batch_upload.sh\n\n# \u6BCF\u6279 50 \u4E2A\u6587\u4EF6\u5206\u6279\u4E0A\u4F20\nFILES=(*.zip)\nBATCH_SIZE=50\n\nfor ((i=0; i<${#FILES[@]}; i+=BATCH_SIZE)); do\n    BATCH=(${FILES[@]:i:BATCH_SIZE})\n    ./manage upload "${BATCH[@]}"\ndone\n'})}),"\n",(0,i.jsx)(e.h4,{id:"2-\u5E76\u884C\u5904\u7406",children:"2. \u5E76\u884C\u5904\u7406"}),"\n",(0,i.jsx)(e.p,{children:"\u4F7F\u7528 GNU parallel \u8FDB\u884C\u5E76\u884C\u4E0A\u4F20\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5B89\u88C5 parallel\uFF08Ubuntu/Debian\uFF09\nsudo apt-get install parallel\n\n# \u5E76\u884C\u4E0A\u4F20\uFF08\u6700\u591A 4 \u4E2A\u5E76\u53D1\uFF09\nls *.zip | parallel -j 4 ./manage upload {}\n"})}),"\n",(0,i.jsx)(e.h4,{id:"3-\u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5",children:"3. \u9519\u8BEF\u5904\u7406\u548C\u91CD\u8BD5"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u811A\u672C\u4E2D\u5904\u7406\u9519\u8BEF\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n\n# \u4E0A\u4F20\u6587\u4EF6\uFF0C\u5931\u8D25\u65F6\u91CD\u8BD5 3 \u6B21\nupload_with_retry() {\n    local file=$1\n    local retries=3\n    local count=0\n\n    until ./manage upload "$file"; do\n        ((count++))\n        if [ $count -ge $retries ]; then\n            echo "\u4E0A\u4F20 $file \u5931\u8D25!")\n            return 1\n        fi\n        echo "\u91CD\u8BD5 $count/$retries..."\n        sleep 5\ndone\n}\n\n# \u4E0A\u4F20\u6240\u6709 zip \u6587\u4EF6\nfor file in *.zip; do\n    upload_with_retry "$file"\ndone\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u5B89\u5168\u6027\u6700\u4F73\u5B9E\u8DF5",children:"\u5B89\u5168\u6027\u6700\u4F73\u5B9E\u8DF5"}),"\n",(0,i.jsx)(e.h3,{id:"1-token-\u5B89\u5168\u7BA1\u7406",children:"1. Token \u5B89\u5168\u7BA1\u7406"}),"\n",(0,i.jsx)(e.h4,{id:"\u65B9\u6848-a\u4F7F\u7528-token-\u6587\u4EF6\u63A8\u8350",children:"\u65B9\u6848 A\uFF1A\u4F7F\u7528 Token \u6587\u4EF6\uFF08\u63A8\u8350\uFF09"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# 1. \u521B\u5EFA token \u6587\u4EF6\necho "ghp_your_token_here" > ~/.github_token\nchmod 600 ~/.github_token\n\n# 2. \u8BBE\u7F6E\u73AF\u5883\u53D8\u91CF\nexport GITHUB_TOKEN_FILE="$HOME/.github_token"\n\n# 3. \u9A8C\u8BC1\u6743\u9650\nls -la ~/.github_token\n# \u5E94\u8BE5\u663E\u793A\uFF1A-rw-------\n'})}),"\n",(0,i.jsx)(e.h4,{id:"\u65B9\u6848-b\u4F7F\u7528\u5BC6\u94A5\u7BA1\u7406\u670D\u52A1",children:"\u65B9\u6848 B\uFF1A\u4F7F\u7528\u5BC6\u94A5\u7BA1\u7406\u670D\u52A1"}),"\n",(0,i.jsx)(e.p,{children:"\u5728 CI/CD \u73AF\u5883\u4E2D\u4F7F\u7528\u5BC6\u94A5\u7BA1\u7406\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# GitHub Actions\nexport GITHUB_TOKEN="${{ secrets.GITHUB_TOKEN }}"\n\n# GitLab CI\nexport GITHUB_TOKEN="$GITHUB_TOKEN"\n\n# AWS Secrets Manager\nexport GITHUB_TOKEN=$(aws secretsmanager get-secret-value \\\n  --secret-id github-token \\\n  --query SecretString \\\n  --output text)\n'})}),"\n",(0,i.jsx)(e.h4,{id:"\u65B9\u6848-c\u4F7F\u7528-gnu-pass",children:"\u65B9\u6848 C\uFF1A\u4F7F\u7528 GNU Pass"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5B89\u88C5 pass\nsudo apt-get install pass\n\n# \u5B58\u50A8 token\npass insert github-token\n# \u8F93\u5165: ghp_your_token_here\n\n# \u4F7F\u7528 token\nexport GITHUB_TOKEN=$(pass github-token)\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2-\u914D\u7F6E\u6587\u4EF6\u6743\u9650",children:"2. \u914D\u7F6E\u6587\u4EF6\u6743\u9650"}),"\n",(0,i.jsx)(e.p,{children:"\u59CB\u7EC8\u8BBE\u7F6E\u914D\u7F6E\u6587\u4EF6\u7684\u6743\u9650\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u521B\u5EFA\u914D\u7F6E\u6587\u4EF6\n./manage config init\n\n# \u68C0\u67E5\u5F53\u524D\u6743\u9650\nls -la .manage_config.json\n\n# \u8BBE\u7F6E\u5B89\u5168\u6743\u9650\uFF08\u4EC5\u6240\u6709\u8005\u53EF\u8BFB\u5199\uFF09\nchmod 600 .manage_config.json\n\n# \u9A8C\u8BC1\u6743\u9650\nls -la .manage_config.json\n# \u5E94\u8BE5\u663E\u793A\uFF1A-rw-------\n"})}),"\n",(0,i.jsx)(e.h3,{id:"3-\u907F\u514D\u5728\u547D\u4EE4\u884C\u4E2D\u66B4\u9732-token",children:"3. \u907F\u514D\u5728\u547D\u4EE4\u884C\u4E2D\u66B4\u9732 Token"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u4E0D\u63A8\u8350"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u4E0D\u8981\u5728\u547D\u4EE4\u884C\u4E2D\u76F4\u63A5\u5199 token\n./manage config set token ghp_my_token_here  # \u4F1A\u5728 shell \u5386\u53F2\u4E2D\u4FDD\u5B58\n"})}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u63A8\u8350"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'# \u65B9\u6CD5 1\uFF1A\u4ECE\u6587\u4EF6\u8BFB\u53D6\necho ghp_my_token_here > token_file\n./manage config set token $(cat token_file)\nrm token_file\n\n# \u65B9\u6CD5 2\uFF1A\u73AF\u5883\u53D8\u91CF\nexport GITHUB_TOKEN="ghp_my_token_here"\n'})}),"\n",(0,i.jsx)(e.h3,{id:"4-\u5BA1\u8BA1\u548C\u65E5\u5FD7",children:"4. \u5BA1\u8BA1\u548C\u65E5\u5FD7"}),"\n",(0,i.jsx)(e.p,{children:"\u8BBE\u7F6E\u9002\u5F53\u7684\u65E5\u5FD7\u7EA7\u522B\u8FDB\u884C\u5BA1\u8BA1\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u8BB0\u5F55\u6240\u6709\u64CD\u4F5C\nexport MANAGE_LOG_LEVEL=0  # DEBUG \u7EA7\u522B\n./manage upload *.zip 2> operation.log\n\n# \u67E5\u770B\u65E5\u5FD7\ncat operation.log\n"})}),"\n",(0,i.jsx)(e.h2,{id:"cicd-\u96C6\u6210\u9AD8\u7EA7\u7528\u6CD5",children:"CI/CD \u96C6\u6210\u9AD8\u7EA7\u7528\u6CD5"}),"\n",(0,i.jsx)(e.h3,{id:"github-actions-\u5B8C\u6574\u793A\u4F8B",children:"GitHub Actions \u5B8C\u6574\u793A\u4F8B"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:"name: Release Management\n\non:\n  push:\n    tags:\n      - 'v*'\n  workflow_dispatch:\n    inputs:\n      version:\n        description: '\u7248\u672C\u53F7'\n        required: true\n        type: string\n\nenv:\n  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}\n  GITHUB_OWNER: ${{ github.repository_owner }}\n  GITHUB_REPO: ${{ github.event.repository.name }}\n\njobs:\n  build-and-upload:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Install dependencies\n        run: |\n          sudo apt-get update\n          sudo apt-get install -y libcurl4-openssl-dev libjson-c-dev\n\n      - name: Compile GitHub Release Manager\n        run: |\n          gcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c)\n\n      - name: Build application\n        run: |\n          make build VERSION=${{ github.event.inputs.version || github.ref_name }}\n\n      - name: Create Release\n        if: github.event_name == 'push'\n        run: |\n          ./manage create-release ${{ github.ref_name }} \\\n            --name \"Release ${{ github.ref_name }}\" \\\n            --description \"Auto-generated release\" \\\n            build/*\n\n      - name: Upload files\n        if: github.event_name == 'workflow_dispatch'\n        run: |\n          ./manage upload build/*\n\n      - name: List Release files\n        run: |\n          ./manage list\n"})}),"\n",(0,i.jsx)(e.h3,{id:"gitlab-ci-\u5B8C\u6574\u793A\u4F8B",children:"GitLab CI \u5B8C\u6574\u793A\u4F8B"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'stages:\n  - build\n  - release\n\nvariables:\n  GITHUB_TOKEN: $GITHUB_TOKEN\n  GITHUB_OWNER: "your-username"\n  GITHUB_REPO: "your-repo"\n\nbefore_script:\n  - apt-get update -qq\n  - apt-get install -y build-essential libcurl4-openssl-dev libjson-c-dev\n  - gcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c)\n\nbuild:\n  stage: build\n  script:\n    - make build VERSION=$CI_COMMIT_TAG\n  artifacts:\n    paths:\n      - build/\n    expire_in: 1 week\n\ncreate:release:\n  stage: release\n  only:\n    - tags\n  script:\n    - ./manage create-release $CI_COMMIT_TAG \\\n        --name "Release $CI_COMMIT_TAG" \\\n        --description "Release from GitLab CI" \\\n        build/*\n\nupload:artifacts:\n  stage: release\n  only:\n    - main\n  script:\n    - ./manage upload build/*\n'})}),"\n",(0,i.jsx)(e.h3,{id:"jenkins-pipeline-\u793A\u4F8B",children:"Jenkins Pipeline \u793A\u4F8B"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-groovy",children:"pipeline {\n    agent any\n\n    environment {\n        GITHUB_TOKEN = credentials('github-token')\n        GITHUB_OWNER = 'your-username'\n        GITHUB_REPO = 'your-repo'\n    }\n\n    stages {\n        stage('Build') {\n            steps {\n                sh 'make build'\n            }\n        }\n\n        stage('Compile Release Manager') {\n            steps {\n                sh '''\n                    gcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c)\n                '''\n            }\n        }\n\n        stage('Create Release') {\n            when {\n                buildingTag()\n            }\n            steps {\n                sh '''\n                    ./manage create-release ${TAG_NAME} \\\n                        --name \"Release ${TAG_NAME}\" \\\n                        build/*\n                '''\n            }\n        }\n\n        stage('Upload Artifacts') {\n            steps {\n                sh './manage upload build/*'\n            }\n        }\n    }\n}\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6027\u80FD\u4F18\u5316",children:"\u6027\u80FD\u4F18\u5316"}),"\n",(0,i.jsx)(e.h3,{id:"1-\u542F\u7528-http2",children:"1. \u542F\u7528 HTTP/2"}),"\n",(0,i.jsx)(e.p,{children:"\u7F16\u8BD1\u65F6\u542F\u7528 HTTP/2\uFF08\u5982\u679C libcurl \u652F\u6301\uFF09\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"gcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c) \\\n  -DCURL_HTTP_VERSION_2TLS\n"})}),"\n",(0,i.jsx)(e.h3,{id:"2-\u8C03\u6574\u7F13\u51B2\u533A\u5927\u5C0F",children:"2. \u8C03\u6574\u7F13\u51B2\u533A\u5927\u5C0F"}),"\n",(0,i.jsx)(e.p,{children:"\u4FEE\u6539\u6E90\u4EE3\u7801\u4E2D\u7684\u7F13\u51B2\u533A\u5927\u5C0F\uFF08\u5982\u679C\u9700\u8981\u4E0A\u4F20\u8D85\u5927\u6587\u4EF6\uFF09\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"// \u5728 manage.c \u4E2D\u627E\u5230\u4EE5\u4E0B\u884C\u5E76\u8C03\u6574\n#define UPLOAD_BUFFER_SIZE 8192  // \u589E\u5927\u7F13\u51B2\u533A\n"})}),"\n",(0,i.jsx)(e.h3,{id:"3-\u7F51\u7EDC\u4F18\u5316",children:"3. \u7F51\u7EDC\u4F18\u5316"}),"\n",(0,i.jsx)(e.p,{children:"\u5728\u9AD8\u5EF6\u8FDF\u7F51\u7EDC\u73AF\u5883\u4E2D\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u51CF\u5C11\u91CD\u8BD5\u5EF6\u8FDF\uFF08\u4FEE\u6539\u6E90\u4EE3\u7801\u4E2D\u7684 baseDelay\uFF09\nstatic int baseDelay = 1;  // \u4ECE 1 \u79D2\u5F00\u59CB\n\n# \u589E\u52A0\u8D85\u65F6\u65F6\u95F4\n# \u5728 curl \u8BBE\u7F6E\u4E2D\u6DFB\u52A0\ncurl_easy_setopt(curl, CURLOPT_TIMEOUT, 300L);  // 5 \u5206\u949F\u8D85\u65F6\n"})}),"\n",(0,i.jsx)(e.h3,{id:"4-\u538B\u7F29\u6587\u4EF6",children:"4. \u538B\u7F29\u6587\u4EF6"}),"\n",(0,i.jsx)(e.p,{children:"\u4E0A\u4F20\u524D\u538B\u7F29\u5927\u6587\u4EF6\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"#!/bin/bash\n# compress-and-upload.sh\n\n# \u538B\u7F29\u6587\u4EF6\uFF08\u4F7F\u7528\u5E76\u884C\u538B\u7F29\uFF09\ntar -I 'pigz -p 4' -cf archive.tar.gz data/\n\n# \u4E0A\u4F20\u538B\u7F29\u6587\u4EF6\n./manage upload archive.tar.gz\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u6545\u969C\u6392\u9664",children:"\u6545\u969C\u6392\u9664"}),"\n",(0,i.jsx)(e.h3,{id:"\u95EE\u9898-1\u4E0A\u4F20\u901F\u5EA6\u6162",children:"\u95EE\u9898 1\uFF1A\u4E0A\u4F20\u901F\u5EA6\u6162"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u539F\u56E0"}),"\uFF1A\u7F51\u7EDC\u5EF6\u8FDF\u6216\u5E26\u5BBD\u9650\u5236"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u538B\u7F29\u6587\u4EF6"}),"\n",(0,i.jsx)(e.li,{children:"\u4F7F\u7528\u591A\u7EBF\u7A0B\u4E0A\u4F20\u5DE5\u5177"}),"\n",(0,i.jsx)(e.li,{children:"\u9009\u62E9\u5C31\u8FD1\u7684 GitHub \u6570\u636E\u4E2D\u5FC3"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u95EE\u9898-2\u9891\u7E41\u89E6\u53D1-api-\u9650\u5236",children:"\u95EE\u9898 2\uFF1A\u9891\u7E41\u89E6\u53D1 API \u9650\u5236"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u539F\u56E0"}),"\uFF1A\u6279\u91CF\u64CD\u4F5C\u8FC7\u4E8E\u9891\u7E41"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u589E\u52A0\u5EF6\u8FDF\uFF08\u5DE5\u5177\u5DF2\u81EA\u52A8\u6DFB\u52A0 0.1 \u79D2\u5EF6\u8FDF\uFF09"}),"\n",(0,i.jsx)(e.li,{children:"\u51CF\u5C11\u5E76\u53D1\u6570"}),"\n",(0,i.jsx)(e.li,{children:"\u8054\u7CFB GitHub \u63D0\u9AD8 API \u9650\u5236"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u95EE\u9898-3\u5927\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25",children:"\u95EE\u9898 3\uFF1A\u5927\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u539F\u56E0"}),"\uFF1A\u7F51\u7EDC\u8D85\u65F6\u6216\u6587\u4EF6\u5927\u5C0F\u9650\u5236"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u5206\u5272\u5927\u6587\u4EF6\uFF1A",(0,i.jsx)(e.code,{children:"split -b 100M largefile.bin part-"})]}),"\n",(0,i.jsx)(e.li,{children:"\u589E\u52A0\u8D85\u65F6\u65F6\u95F4"}),"\n",(0,i.jsx)(e.li,{children:"\u786E\u4FDD\u6587\u4EF6 < 2GB\uFF08GitHub \u9650\u5236\uFF09"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u95EE\u9898-4token-\u6743\u9650\u4E0D\u8DB3",children:"\u95EE\u9898 4\uFF1AToken \u6743\u9650\u4E0D\u8DB3"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u9519\u8BEF"}),"\uFF1A",(0,i.jsx)(e.code,{children:"404 Not Found"})," \u6216 ",(0,i.jsx)(e.code,{children:"403 Forbidden"})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsxs)(e.li,{children:["\u68C0\u67E5 token \u662F\u5426\u6709 ",(0,i.jsx)(e.code,{children:"repo"})," \u4F5C\u7528\u57DF"]}),"\n",(0,i.jsx)(e.li,{children:"\u68C0\u67E5\u4ED3\u5E93\u662F\u5426\u5B58\u5728"}),"\n",(0,i.jsx)(e.li,{children:"\u68C0\u67E5\u662F\u5426\u6709\u5199\u5165\u6743\u9650"}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u95EE\u9898-5release-\u4E0D\u5B58\u5728",children:"\u95EE\u9898 5\uFF1ARelease \u4E0D\u5B58\u5728"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u9519\u8BEF"}),"\uFF1A",(0,i.jsx)(e.code,{children:'\u672A\u627E\u5230tag\u4E3A "v1.0.0" \u7684release'})]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:"\u89E3\u51B3\u65B9\u6848"}),"\uFF1A"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u5148\u521B\u5EFA Release\n./manage create-release v1.0.0\n\n# \u7136\u540E\u4E0A\u4F20\u6587\u4EF6\n./manage upload *.zip\n"})}),"\n",(0,i.jsx)(e.h2,{id:"\u76D1\u63A7\u548C\u65E5\u5FD7",children:"\u76D1\u63A7\u548C\u65E5\u5FD7"}),"\n",(0,i.jsx)(e.h3,{id:"\u8BE6\u7EC6\u65E5\u5FD7",children:"\u8BE6\u7EC6\u65E5\u5FD7"}),"\n",(0,i.jsx)(e.p,{children:"\u542F\u7528\u8C03\u8BD5\u65E5\u5FD7\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u8BBE\u7F6E\u65E5\u5FD7\u7EA7\u522B\u4E3A DEBUG\nexport MANAGE_LOG_LEVEL=0\n\n# \u91CD\u5B9A\u5411\u65E5\u5FD7\u5230\u6587\u4EF6\n./manage upload *.zip 2> debug.log\n\n# \u67E5\u770B\u5B9E\u65F6\u65E5\u5FD7\ntail -f debug.log\n"})}),"\n",(0,i.jsx)(e.h3,{id:"json-\u65E5\u5FD7\u683C\u5F0F",children:"JSON \u65E5\u5FD7\u683C\u5F0F"}),"\n",(0,i.jsx)(e.p,{children:"\u5BF9\u4E8E\u65E5\u5FD7\u6536\u96C6\u7CFB\u7EDF\uFF0C\u53EF\u4EE5\u4FEE\u6539\u6E90\u4EE3\u7801\u8F93\u51FA JSON \u683C\u5F0F\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:'// \u4FEE\u6539 log_message \u51FD\u6570\u8F93\u51FA JSON\nfprintf(stderr, "{\\"level\\":\\"%s\\",\\"message\\":\\"", level_strs[level]);\nvfprintf(stderr, fmt, args);\nfprintf(stderr, "\\"}\\n");\n'})}),"\n",(0,i.jsx)(e.h3,{id:"\u76D1\u63A7\u811A\u672C",children:"\u76D1\u63A7\u811A\u672C"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:'#!/bin/bash\n# monitor.sh\n\nLOG_FILE="/var/log/github-release-manager.log"\n\n# \u76D1\u63A7\u4E0A\u4F20\u64CD\u4F5C\nupload_and_log() {\n    local files=$1\n    local timestamp=$(date \'+%Y-%m-%d %H:%M:%S\')\n\n    echo "[$timestamp] Starting upload: $files" >> $LOG_FILE\n\n    if ./manage upload $files; then\n        echo "[$timestamp] Upload success: $files" >> $LOG_FILE\n        return 0\n    else\n        echo "[$timestamp] Upload failed: $files" >> $LOG_FILE\n        return 1\n    fi\n}\n\n# \u4F7F\u7528\u793A\u4F8B\nupload_and_log "*.zip"\n'})}),"\n",(0,i.jsx)(e.h2,{id:"\u81EA\u5B9A\u4E49\u548C\u6269\u5C55",children:"\u81EA\u5B9A\u4E49\u548C\u6269\u5C55"}),"\n",(0,i.jsx)(e.h3,{id:"\u6DFB\u52A0\u65B0\u529F\u80FD",children:"\u6DFB\u52A0\u65B0\u529F\u80FD"}),"\n",(0,i.jsx)(e.p,{children:"\u8981\u6DFB\u52A0\u65B0\u547D\u4EE4\uFF0C\u9700\u8981\uFF1A"}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u5B9E\u73B0\u529F\u80FD\u51FD\u6570\uFF1A"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:"// \u5728 manage.c \u4E2D\u6DFB\u52A0\nstatic ErrorCode myNewCommand(const char *param, const Config *config) {\n    // \u5B9E\u73B0\u529F\u80FD\n    return ERR_OK;\n}\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:"\u5728\u4E3B\u51FD\u6570\u4E2D\u6DFB\u52A0\u547D\u4EE4\u5904\u7406\uFF1A"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-c",children:'// \u5728 main \u51FD\u6570\u7684\u547D\u4EE4\u5904\u7406\u90E8\u5206\nelse if (strcmp(command, "my-command") == 0) {\n    // \u8C03\u7528\u4F60\u7684\u51FD\u6570\n}\n'})}),"\n",(0,i.jsxs)(e.ol,{start:"3",children:["\n",(0,i.jsxs)(e.li,{children:["\u66F4\u65B0\u5E2E\u52A9\u4FE1\u606F\uFF08",(0,i.jsx)(e.code,{children:"showUsage"})," \u548C ",(0,i.jsx)(e.code,{children:"showDetailedUsage"})," \u51FD\u6570\uFF09"]}),"\n"]}),"\n",(0,i.jsx)(e.h3,{id:"\u7F16\u8BD1\u9009\u9879",children:"\u7F16\u8BD1\u9009\u9879"}),"\n",(0,i.jsx)(e.p,{children:"\u7F16\u8BD1\u65F6\u6DFB\u52A0\u81EA\u5B9A\u4E49\u9009\u9879\uFF1A"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"# \u542F\u7528\u6240\u6709\u8B66\u544A\n\ngcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c) \\\n  -Wall -Wextra -Wpedantic -O2\n\n# \u9759\u6001\u94FE\u63A5\uFF08\u751F\u6210\u72EC\u7ACB\u53EF\u6267\u884C\u6587\u4EF6\uFF0C\u4E0D\u63A8\u8350\uFF0C\u4F46\u53EF\u80FD\u5728\u67D0\u4E9B\u73AF\u5883\u9700\u8981\uFF09\n\ngcc manage.c -o manage $(pkg-config --cflags --libs libcurl json-c) \\\n  -static -O2\n"})})]})}function h(n={}){let{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},8453:(n,e,l)=>{l.d(e,{R:()=>r,x:()=>d});var s=l(6540);let i={},a=s.createContext(i);function r(n){let e=s.useContext(a);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),s.createElement(a.Provider,{value:e},n.children)}}}]);